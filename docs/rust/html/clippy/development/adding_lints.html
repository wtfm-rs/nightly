<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Adding Lints - Clippy Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-37577245.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-0b42a744.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Clippy Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/rust-lang/rust-clippy/tree/master/book" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>
                        <a href="https://github.com/rust-lang/rust-clippy/edit/master/book/src/development/adding_lints.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <span class=fa-svg id="git-edit-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M421.7 220.3l-11.3 11.3-22.6 22.6-205 205c-6.6 6.6-14.8 11.5-23.8 14.1L30.8 511c-8.4 2.5-17.5 .2-23.7-6.1S-1.5 489.7 1 481.2L38.7 353.1c2.6-9 7.5-17.2 14.1-23.8l205-205 22.6-22.6 11.3-11.3 33.9 33.9 62.1 62.1 33.9 33.9zM96 353.9l-9.3 9.3c-.9 .9-1.6 2.1-2 3.4l-25.3 86 86-25.3c1.3-.4 2.5-1.1 3.4-2l9.3-9.3H112c-8.8 0-16-7.2-16-16V353.9zM453.3 19.3l39.4 39.4c25 25 25 65.5 0 90.5l-14.5 14.5-22.6 22.6-11.3 11.3-33.9-33.9-62.1-62.1L314.3 67.7l11.3-11.3 22.6-22.6 14.5-14.5c25-25 65.5-25 90.5 0z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="adding-a-new-lint"><a class="header" href="#adding-a-new-lint">Adding a new lint</a></h1>
<p>You are probably here because you want to add a new lint to Clippy. If this is
the first time you’re contributing to Clippy, this document guides you through
creating an example lint from scratch.</p>
<p>To get started, we will create a lint that detects functions called <code>foo</code>,
because that’s clearly a non-descriptive name.</p>
<ul>
<li><a href="#adding-a-new-lint">Adding a new lint</a>
<ul>
<li><a href="#setup">Setup</a></li>
<li><a href="#getting-started">Getting Started</a>
<ul>
<li><a href="#defining-our-lint">Defining Our Lint</a>
<ul>
<li><a href="#standalone">Standalone</a></li>
<li><a href="#specific-type">Specific Type</a></li>
<li><a href="#tests-location">Tests Location</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#testing">Testing</a>
<ul>
<li><a href="#cargo-lints">Cargo lints</a></li>
</ul>
</li>
<li><a href="#rustfix-tests">Rustfix tests</a></li>
<li><a href="#testing-manually">Testing manually</a></li>
<li><a href="#lint-declaration">Lint declaration</a></li>
<li><a href="#lint-registration">Lint registration</a></li>
<li><a href="#lint-passes">Lint passes</a></li>
<li><a href="#emitting-a-lint">Emitting a lint</a></li>
<li><a href="#adding-the-lint-logic">Adding the lint logic</a></li>
<li><a href="#specifying-the-lints-minimum-supported-rust-version-msrv">Specifying the lint’s minimum supported Rust version (MSRV)</a></li>
<li><a href="#author-lint">Author lint</a></li>
<li><a href="#print-hir-lint">Print HIR lint</a></li>
<li><a href="#documentation">Documentation</a></li>
<li><a href="#running-rustfmt">Running rustfmt</a></li>
<li><a href="#debugging">Debugging</a></li>
<li><a href="#conflicting-lints">Conflicting lints</a></li>
<li><a href="#pr-checklist">PR Checklist</a></li>
<li><a href="#adding-configuration-to-a-lint">Adding configuration to a lint</a></li>
<li><a href="#cheat-sheet">Cheat Sheet</a></li>
</ul>
</li>
</ul>
<h2 id="setup"><a class="header" href="#setup">Setup</a></h2>
<p>See the <a href="basics.html#get-the-code">Basics</a> documentation.</p>
<h2 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h2>
<p>There is a bit of boilerplate code that needs to be set up when creating a new
lint. Fortunately, you can use the Clippy dev tools to handle this for you. We
are naming our new lint <code>foo_functions</code> (lints are generally written in snake
case), and we don’t need type information, so it will have an early pass type
(more on this later). If you’re unsure if the name you chose fits the lint,
take a look at our <a href="https://rust-lang.github.io/rfcs/0344-conventions-galore.html#lints">lint naming guidelines</a>.</p>
<h2 id="defining-our-lint"><a class="header" href="#defining-our-lint">Defining Our Lint</a></h2>
<p>To get started, there are two ways to define our lint.</p>
<h3 id="standalone"><a class="header" href="#standalone">Standalone</a></h3>
<p>Command: <code>cargo dev new_lint --name=foo_functions --pass=early --category=pedantic</code>
(category will default to nursery if not provided)</p>
<p>This command will create a new file: <code>clippy_lints/src/foo_functions.rs</code>, as well
as <a href="#lint-registration">register the lint</a>.</p>
<h3 id="specific-type"><a class="header" href="#specific-type">Specific Type</a></h3>
<p>Command: <code>cargo dev new_lint --name=foo_functions --type=functions --category=pedantic</code></p>
<p>This command will create a new file: <code>clippy_lints/src/{type}/foo_functions.rs</code>.</p>
<p>Notice how this command has a <code>--type</code> flag instead of <code>--pass</code>. Unlike a standalone
definition, this lint won’t be registered in the traditional sense. Instead, you will
call your lint from within the type’s lint pass, found in <code>clippy_lints/src/{type}/mod.rs</code>.</p>
<p>A “type” is just the name of a directory in <code>clippy_lints/src</code>, like <code>functions</code> in
the example command. These are groupings of lints with common behaviors, so if your
lint falls into one, it would be best to add it to that type.</p>
<h3 id="tests-location"><a class="header" href="#tests-location">Tests Location</a></h3>
<p>Both commands will create a file: <code>tests/ui/foo_functions.rs</code>. For cargo lints,
two project hierarchies (fail/pass) will be created by default under <code>tests/ui-cargo</code>.</p>
<p>Next, we’ll open up these files and add our lint!</p>
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<p>Let’s write some tests first that we can execute while we iterate on our lint.</p>
<p>Clippy uses UI tests for testing. UI tests check that the output of Clippy is
exactly as expected. Each test is just a plain Rust file that contains the code
we want to check. The output of Clippy is compared against a <code>.stderr</code> file.
Note that you don’t have to create this file yourself, we’ll get to generating
the <code>.stderr</code> files further down.</p>
<p>We start by opening the test file created at <code>tests/ui/foo_functions.rs</code>.</p>
<p>Update the file with some examples to get started:</p>
<pre class="playground"><code class="language-rust edition2024">#![allow(unused)]
#![warn(clippy::foo_functions)]

// Impl methods
struct A;
impl A {
    pub fn fo(&amp;self) {}
    pub fn foo(&amp;self) {}
    //~^ foo_functions
    pub fn food(&amp;self) {}
}

// Default trait methods
trait B {
    fn fo(&amp;self) {}
    fn foo(&amp;self) {}
    //~^ foo_functions
    fn food(&amp;self) {}
}

// Plain functions
fn fo() {}
fn foo() {}
//~^ foo_functions
fn food() {}

fn main() {
    // We also don't want to lint method calls
    foo();
    let a = A;
    a.foo();
}</code></pre>
<p>Note that we are adding comment annotations with the name of our lint to mark
lines where we expect an error. Except for very specific situations
(<code>//@check-pass</code>), at least one error marker must be present in a test file for
it to be accepted.</p>
<p>Once we have implemented our lint we can run <code>TESTNAME=foo_functions cargo uibless</code> to generate the <code>.stderr</code> file. If our lint makes use of structured
suggestions then this command will also generate the corresponding <code>.fixed</code>
file.</p>
<p>While we are working on implementing our lint, we can keep running the UI test.
That allows us to check if the output is turning into what we want by checking the
<code>.stderr</code> file that gets updated on every test run.</p>
<p>Once we have implemented our lint running <code>TESTNAME=foo_functions cargo uitest</code>
should pass on its own. When we commit our lint, we need to commit the generated
<code>.stderr</code> and if applicable <code>.fixed</code> files, too. In general, you should only
commit files changed by <code>cargo bless</code> for the specific lint you are creating/editing.</p>
<blockquote>
<p><em>Note:</em> you can run multiple test files by specifying a comma separated list:
<code>TESTNAME=foo_functions,test2,test3</code>.</p>
</blockquote>
<h3 id="cargo-lints"><a class="header" href="#cargo-lints">Cargo lints</a></h3>
<p>For cargo lints, the process of testing differs in that we are interested in the
<code>Cargo.toml</code> manifest file. We also need a minimal crate associated with that
manifest.</p>
<p>If our new lint is named e.g. <code>foo_categories</code>, after running <code>cargo dev new_lint --name=foo_categories --type=cargo --category=cargo</code> we will find by
default two new crates, each with its manifest file:</p>
<ul>
<li><code>tests/ui-cargo/foo_categories/fail/Cargo.toml</code>: this file should cause the
new lint to raise an error.</li>
<li><code>tests/ui-cargo/foo_categories/pass/Cargo.toml</code>: this file should not trigger
the lint.</li>
</ul>
<p>If you need more cases, you can copy one of those crates (under
<code>foo_categories</code>) and rename it.</p>
<p>The process of generating the <code>.stderr</code> file is the same, and prepending the
<code>TESTNAME</code> variable to <code>cargo uitest</code> works too.</p>
<h2 id="rustfix-tests"><a class="header" href="#rustfix-tests">Rustfix tests</a></h2>
<p>If the lint you are working on is making use of structured suggestions, the test
will create a <code>.fixed</code> file by running <a href="https://github.com/rust-lang/cargo/tree/master/crates/rustfix">rustfix</a> for that test.
Rustfix will apply the suggestions
from the lint to the code of the test file and compare that to the contents of a
<code>.fixed</code> file.</p>
<p>Use <code>cargo bless</code> to automatically generate the <code>.fixed</code> file while running
the tests.</p>
<h2 id="testing-manually"><a class="header" href="#testing-manually">Testing manually</a></h2>
<p>Manually testing against an example file can be useful if you have added some
<code>println!</code>s and the test suite output becomes unreadable. To try Clippy with
your local modifications, run the following from the Clippy directory:</p>
<pre><code class="language-bash">cargo dev lint input.rs
</code></pre>
<p>To run Clippy on an existing project rather than a single file you can use</p>
<pre><code class="language-bash">cargo dev lint /path/to/project
</code></pre>
<p>Or set up a rustup toolchain that points to the local Clippy binaries</p>
<pre><code class="language-bash">cargo dev setup toolchain

# Then in `/path/to/project` you can run
cargo +clippy clippy
</code></pre>
<h2 id="lint-declaration"><a class="header" href="#lint-declaration">Lint declaration</a></h2>
<p>Let’s start by opening the new file created in the <code>clippy_lints</code> crate at
<code>clippy_lints/src/foo_functions.rs</code>. That’s the crate where all the lint code
is. This file has already imported some initial things we will need:</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use rustc_lint::{EarlyLintPass, EarlyContext};
use rustc_session::declare_lint_pass;
use rustc_ast::ast::*;
<span class="boring">}</span></code></pre>
<p>The next step is to update the lint declaration. Lints are declared using the
<a href="https://github.com/rust-lang/rust-clippy/blob/557f6848bd5b7183f55c1e1522a326e9e1df6030/clippy_lints/src/lib.rs#L60"><code>declare_clippy_lint!</code></a> macro, and we just need to update
the auto-generated lint declaration to have a real description, something like
this:</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>declare_clippy_lint! {
    /// ### What it does
    ///
    /// ### Why is this bad?
    ///
    /// ### Example
    /// ```rust
    /// // example code
    /// ```
    #[clippy::version = "1.29.0"]
    pub FOO_FUNCTIONS,
    pedantic,
    "function named `foo`, which is not a descriptive name"
}
<span class="boring">}</span></code></pre>
<ul>
<li>The section of lines prefixed with <code>///</code> constitutes the lint documentation
section. This is the default documentation style and will be displayed <a href="https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure">like
this</a>. To render and open this documentation locally in a
browser, run <code>cargo dev serve</code>.</li>
<li>The <code>#[clippy::version]</code> attribute will be rendered as part of the lint
documentation. The value should be set to the current Rust version that the
lint is developed in, it can be retrieved by running <code>rustc -vV</code> in the
rust-clippy directory. The version is listed under <em>release</em>. (Use the version
without the <code>-nightly</code>) suffix.</li>
<li><code>FOO_FUNCTIONS</code> is the name of our lint. Be sure to follow the <a href="https://rust-lang.github.io/rfcs/0344-conventions-galore.html#lints">lint naming
guidelines</a> here when naming your lint. In short, the name should
state the thing that is being checked for and read well when used with
<code>allow</code>/<code>warn</code>/<code>deny</code>.</li>
<li><code>pedantic</code> sets the lint level to <code>Allow</code>. The exact mapping can be found
<a href="../index.html">here</a></li>
<li>The last part should be a text that explains what exactly is wrong with the
code</li>
</ul>
<p>The rest of this file contains an empty implementation for our lint pass, which
in this case is <code>EarlyLintPass</code> and should look like this:</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// clippy_lints/src/foo_functions.rs

// .. imports and lint declaration ..

declare_lint_pass!(FooFunctions =&gt; [FOO_FUNCTIONS]);

impl EarlyLintPass for FooFunctions {}
<span class="boring">}</span></code></pre>
<h2 id="lint-registration"><a class="header" href="#lint-registration">Lint registration</a></h2>
<p>When using <code>cargo dev new_lint</code>, the lint is automatically registered and
nothing more has to be done.</p>
<p>When declaring a new lint by hand and <code>cargo dev update_lints</code> is used, the lint
pass may have to be registered manually in the <code>register_lints</code> function in
<code>clippy_lints/src/lib.rs</code>:</p>
<pre><code class="language-rust ignore">store.register_early_pass(|| Box::new(foo_functions::FooFunctions));</code></pre>
<p>As one may expect, there is a corresponding <code>register_late_pass</code> method
available as well. Without a call to one of <code>register_early_pass</code> or
<code>register_late_pass</code>, the lint pass in question will not be run.</p>
<p>One reason that <code>cargo dev update_lints</code> does not automate this step is that
multiple lints can use the same lint pass, so registering the lint pass may
already be done when adding a new lint. Another reason that this step is not
automated is that the order that the passes are registered determines the order
the passes actually run, which in turn affects the order that any emitted lints
are output in.</p>
<h2 id="lint-passes"><a class="header" href="#lint-passes">Lint passes</a></h2>
<p>Writing a lint that only checks for the name of a function means that we only
have to deal with the AST and don’t have to deal with the type system at all.
This is good, because it makes writing this particular lint less complicated.</p>
<p>We have to make this decision with every new Clippy lint. It boils down to using
either <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_lint/trait.EarlyLintPass.html"><code>EarlyLintPass</code></a> or <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_lint/trait.LateLintPass.html"><code>LateLintPass</code></a>.</p>
<p><code>EarlyLintPass</code> runs before type checking and
<a href="https://rustc-dev-guide.rust-lang.org/hir.html">HIR</a> lowering, while <code>LateLintPass</code>
runs after these stages, providing access to type information. The <code>cargo dev new_lint</code> command
defaults to the recommended <code>LateLintPass</code>, but you can specify <code>--pass=early</code> if your lint
only needs AST level analysis.</p>
<p>Since we don’t need type information for checking the function name, we used
<code>--pass=early</code> when running the new lint automation and all the imports were
added accordingly.</p>
<h2 id="emitting-a-lint"><a class="header" href="#emitting-a-lint">Emitting a lint</a></h2>
<p>With UI tests and the lint declaration in place, we can start working on the
implementation of the lint logic.</p>
<p>Let’s start by implementing the <code>EarlyLintPass</code> for our <code>FooFunctions</code>:</p>
<pre><code class="language-rust ignore">impl EarlyLintPass for FooFunctions {
    fn check_fn(&amp;mut self, cx: &amp;EarlyContext&lt;'_&gt;, fn_kind: FnKind&lt;'_&gt;, span: Span, _: NodeId) {
        // TODO: Emit lint here
    }
}</code></pre>
<p>We implement the <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_lint/trait.EarlyLintPass.html#method.check_fn"><code>check_fn</code></a> method from the
<a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_lint/trait.EarlyLintPass.html"><code>EarlyLintPass</code></a> trait. This gives us access to various
information about the function that is currently being checked. More on that in
the next section. Let’s worry about the details later and emit our lint for
<em>every</em> function definition first.</p>
<p>Depending on how complex we want our lint message to be, we can choose from a
variety of lint emission functions. They can all be found in
<a href="https://github.com/rust-lang/rust-clippy/blob/master/clippy_utils/src/diagnostics.rs"><code>clippy_utils/src/diagnostics.rs</code></a>.</p>
<p><code>span_lint_and_help</code> seems most appropriate in this case. It allows us to
provide an extra help message, and we can’t really suggest a better name
automatically. This is how it looks:</p>
<pre><code class="language-rust ignore">impl EarlyLintPass for FooFunctions {
    fn check_fn(&amp;mut self, cx: &amp;EarlyContext&lt;'_&gt;, fn_kind: FnKind&lt;'_&gt;, span: Span, _: NodeId) {
        span_lint_and_help(
            cx,
            FOO_FUNCTIONS,
            span,
            "function named `foo`",
            None,
            "consider using a more meaningful name"
        );
    }
}</code></pre>
<p>Running our UI test should now produce output that contains the lint message.</p>
<p>According to <a href="https://rustc-dev-guide.rust-lang.org/diagnostics.html">the rustc-dev-guide</a>, the text should be matter of fact and avoid
capitalization and periods, unless multiple sentences are needed. When code or
an identifier must appear in a message or label, it should be surrounded with
single grave accents `.</p>
<h2 id="adding-the-lint-logic"><a class="header" href="#adding-the-lint-logic">Adding the lint logic</a></h2>
<p>Writing the logic for your lint will most likely be different from our example,
so this section is kept rather short.</p>
<p>Using the <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_lint/trait.EarlyLintPass.html#method.check_fn"><code>check_fn</code></a> method gives us access to <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_ast/visit/enum.FnKind.html"><code>FnKind</code></a>
that has the <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_ast/visit/enum.FnKind.html#variant.Fn"><code>FnKind::Fn</code></a> variant. It provides access to the name of the
function/method via an <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_span/symbol/struct.Ident.html"><code>Ident</code></a>.</p>
<p>With that we can expand our <code>check_fn</code> method to:</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl EarlyLintPass for FooFunctions {
    fn check_fn(&amp;mut self, cx: &amp;EarlyContext&lt;'_&gt;, fn_kind: FnKind&lt;'_&gt;, span: Span, _: NodeId) {
        if is_foo_fn(fn_kind) {
            span_lint_and_help(
                cx,
                FOO_FUNCTIONS,
                span,
                "function named `foo`",
                None,
                "consider using a more meaningful name"
            );
        }
    }
}
<span class="boring">}</span></code></pre>
<p>We separate the lint conditional from the lint emissions because it makes the
code a bit easier to read. In some cases this separation would also allow to
write some unit tests (as opposed to only UI tests) for the separate function.</p>
<p>In our example, <code>is_foo_fn</code> looks like:</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// use statements, impl EarlyLintPass, check_fn, ..

fn is_foo_fn(fn_kind: FnKind&lt;'_&gt;) -&gt; bool {
    match fn_kind {
        FnKind::Fn(_, _, Fn { ident, .. }) =&gt; {
            // check if `fn` name is `foo`
            ident.name.as_str() == "foo"
        }
        // ignore closures
        FnKind::Closure(..) =&gt; false
    }
}
<span class="boring">}</span></code></pre>
<p>Now we should also run the full test suite with <code>cargo test</code>. At this point
running <code>cargo test</code> should produce the expected output. Remember to run <code>cargo bless</code> to update the <code>.stderr</code> file.</p>
<p><code>cargo test</code> (as opposed to <code>cargo uitest</code>) will also ensure that our lint
implementation is not violating any Clippy lints itself.</p>
<p>That should be it for the lint implementation. Running <code>cargo test</code> should now
pass.</p>
<h2 id="specifying-the-lints-minimum-supported-rust-version-msrv"><a class="header" href="#specifying-the-lints-minimum-supported-rust-version-msrv">Specifying the lint’s minimum supported Rust version (MSRV)</a></h2>
<p>Sometimes a lint makes suggestions that require a certain version of Rust. For
example, the <code>manual_strip</code> lint suggests using <code>str::strip_prefix</code> and
<code>str::strip_suffix</code> which is only available after Rust 1.45. In such cases, you
need to ensure that the MSRV configured for the project is &gt;= the MSRV of the
required Rust feature. If multiple features are required, just use the one with
a lower MSRV.</p>
<p>First, add an MSRV alias for the required feature in <a href="https://doc.rust-lang.org/nightly/nightly-rustc/clippy_config/msrvs/index.html"><code>clippy_utils::msrvs</code></a>.
This can be accessed later as <code>msrvs::STR_STRIP_PREFIX</code>, for example.</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>msrv_aliases! {
    ..
    1,45,0 { STR_STRIP_PREFIX }
}
<span class="boring">}</span></code></pre>
<p>In order to access the project-configured MSRV, you need to have an <code>msrv</code> field
in the LintPass struct, and a constructor to initialize the field. The <code>msrv</code>
value is passed to the constructor in <code>clippy_lints/lib.rs</code>.</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct ManualStrip {
    msrv: Msrv,
}

impl ManualStrip {
    pub fn new(conf: &amp;'static Conf) -&gt; Self {
        Self { msrv: conf.msrv }
    }
}
<span class="boring">}</span></code></pre>
<p>The project’s MSRV can then be matched against the feature MSRV in the LintPass
using the <code>Msrv::meets</code> method.</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>if !self.msrv.meets(cx, msrvs::STR_STRIP_PREFIX) {
    return;
}
<span class="boring">}</span></code></pre>
<p>Early lint passes should instead use <code>MsrvStack</code> coupled with
<code>extract_msrv_attr!()</code></p>
<p>Once the <code>msrv</code> is added to the lint, a relevant test case should be added to
the lint’s test file, <code>tests/ui/manual_strip.rs</code> in this example. It should
have a case for the version below the MSRV and one with the same contents but
for the MSRV version itself.</p>
<pre><code class="language-rust ignore">...

#[clippy::msrv = "1.44"]
fn msrv_1_44() {
    /* something that would trigger the lint */
}

#[clippy::msrv = "1.45"]
fn msrv_1_45() {
    /* something that would trigger the lint */
}</code></pre>
<p>As a last step, the lint should be added to the lint documentation. This is done
in <code>clippy_config/src/conf.rs</code>:</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>define_Conf! {
    #[lints(
        allow_attributes,
        allow_attributes_without_reason,
        ..
        &lt;the newly added lint name&gt;,
        ..
        unused_trait_names,
        use_self,
    )]
    msrv: Msrv = Msrv::default(),
    ...
}
<span class="boring">}</span></code></pre>
<p>Afterwards update the documentation for the book as described in <a href="#adding-configuration-to-a-lint">Adding configuration to a lint</a>.</p>
<h2 id="author-lint"><a class="header" href="#author-lint">Author lint</a></h2>
<p>If you have trouble implementing your lint, there is also the internal <code>author</code>
lint to generate Clippy code that detects the offending pattern. It does not
work for all the Rust syntax, but can give a good starting point.</p>
<p>The quickest way to use it, is the <a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2024&amp;gist=9a12cb60e5c6ad4e3003ac6d5e63cf55">Rust playground:
play.rust-lang.org</a>. Put the code you want to lint into the
editor and add the <code>#[clippy::author]</code> attribute above the item. Then run Clippy
via <code>Tools -&gt; Clippy</code> and you should see the generated code in the output below.</p>
<p><a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2024&amp;gist=9a12cb60e5c6ad4e3003ac6d5e63cf55">Here</a> is an example on the playground.</p>
<p>If the command was executed successfully, you can copy the code over to where
you are implementing your lint.</p>
<h2 id="print-hir-lint"><a class="header" href="#print-hir-lint">Print HIR lint</a></h2>
<p>To implement a lint, it’s helpful to first understand the internal
representation that rustc uses. Clippy has the <code>#[clippy::dump]</code> attribute that
prints the <a href="https://rustc-dev-guide.rust-lang.org/hir.html"><em>High-Level Intermediate Representation (HIR)</em></a> of the item,
statement, or expression that the attribute is attached to. To attach the
attribute to expressions you often need to enable
<code>#![feature(stmt_expr_attributes)]</code>.</p>
<p><a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2024&amp;gist=daf14db3a7f39ca467cd1b86c34b9afb">Here</a> you can find an example, just select <em>Tools</em> and run
<em>Clippy</em>.</p>
<h2 id="documentation"><a class="header" href="#documentation">Documentation</a></h2>
<p>The final thing before submitting our PR is to add some documentation to our
lint declaration.</p>
<p>Please document your lint with a doc comment akin to the following:</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>declare_clippy_lint! {
    /// ### What it does
    /// Checks for ... (describe what the lint matches).
    ///
    /// ### Why is this bad?
    /// Supply the reason for linting the code.
    ///
    /// ### Example
    ///
    /// ```rust,ignore
    /// // A short example of code that triggers the lint
    /// ```
    ///
    /// Use instead:
    /// ```rust,ignore
    /// // A short example of improved code that doesn't trigger the lint
    /// ```
    #[clippy::version = "1.29.0"]
    pub FOO_FUNCTIONS,
    pedantic,
    "function named `foo`, which is not a descriptive name"
}
<span class="boring">}</span></code></pre>
<p>If the lint is in the <code>restriction</code> group because it lints things that are not
necessarily “bad” but are more of a style choice, then replace the
“Why is this bad?” section heading with “Why restrict this?”, to avoid writing
“Why is this bad? It isn’t, but …”.</p>
<p>Once your lint is merged, this documentation will show up in the <a href="https://rust-lang.github.io/rust-clippy/master/index.html">lint
list</a>.</p>
<h2 id="running-rustfmt"><a class="header" href="#running-rustfmt">Running rustfmt</a></h2>
<p><a href="https://github.com/rust-lang/rustfmt">Rustfmt</a> is a tool for formatting Rust code according to style guidelines. Your
code has to be formatted by <code>rustfmt</code> before a PR can be merged. Clippy uses
nightly <code>rustfmt</code> in the CI.</p>
<p>It can be installed via <code>rustup</code>:</p>
<pre><code class="language-bash">rustup component add rustfmt --toolchain=nightly
</code></pre>
<p>Use <code>cargo dev fmt</code> to format the whole codebase. Make sure that <code>rustfmt</code> is
installed for the nightly toolchain.</p>
<h2 id="debugging"><a class="header" href="#debugging">Debugging</a></h2>
<p>If you want to debug parts of your lint implementation, you can use the <a href="https://doc.rust-lang.org/std/macro.dbg.html"><code>dbg!</code></a>
macro anywhere in your code. Running the tests should then include the debug
output in the <code>stdout</code> part.</p>
<h2 id="conflicting-lints"><a class="header" href="#conflicting-lints">Conflicting lints</a></h2>
<p>There are several lints that deal with the same pattern but suggest different approaches. In other words, some lints
may suggest modifications that go in the opposite direction to what some other lints already propose for the same
code, creating conflicting diagnostics.</p>
<p>When you are creating a lint that ends up in this scenario, the following tips should be encouraged to guide
classification:</p>
<ul>
<li>The only case where they should be in the same category is if that category is <code>restriction</code>. For example,
<code>semicolon_inside_block</code> and <code>semicolon_outside_block</code>.</li>
<li>For all the other cases, they should be in different categories with different levels of allowance. For example,
<code>implicit_return</code> (restriction, allow) and <code>needless_return</code> (style, warn).</li>
</ul>
<p>For lints that are in different categories, it is also recommended that at least one of them should be in the
<code>restriction</code> category. The reason for this is that the <code>restriction</code> group is the only group where we don’t
recommend to enable the entire set, but cherry pick lints out of.</p>
<h2 id="pr-checklist"><a class="header" href="#pr-checklist">PR Checklist</a></h2>
<p>Before submitting your PR make sure you followed all the basic requirements:</p>
<!-- Sync this with `.github/PULL_REQUEST_TEMPLATE` -->
<ul>
<li>[ ] Followed <a href="https://rust-lang.github.io/rfcs/0344-conventions-galore.html#lints">lint naming conventions</a></li>
<li>[ ] Added passing UI tests (including committed <code>.stderr</code> file)</li>
<li>[ ] <code>cargo test</code> passes locally</li>
<li>[ ] Executed <code>cargo dev update_lints</code></li>
<li>[ ] Added lint documentation</li>
<li>[ ] Run <code>cargo dev fmt</code></li>
</ul>
<h2 id="adding-configuration-to-a-lint"><a class="header" href="#adding-configuration-to-a-lint">Adding configuration to a lint</a></h2>
<p>Clippy supports the configuration of lints values using a <code>clippy.toml</code> file which is searched for in:</p>
<ol>
<li>The directory specified by the <code>CLIPPY_CONF_DIR</code> environment variable, or</li>
<li>The directory specified by the
<a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html">CARGO_MANIFEST_DIR</a> environment variable, or</li>
<li>The current directory.</li>
</ol>
<p>Adding a configuration to a lint can be useful for
thresholds or to constrain some behavior that can be seen as a false positive
for some users. Adding a configuration is done in the following steps:</p>
<ol>
<li>
<p>Adding a new configuration entry to <a href="https://github.com/rust-lang/rust-clippy/blob/master/clippy_config/src/conf.rs"><code>clippy_config::conf</code></a> like this:</p>
<pre><code class="language-rust ignore">/// Lint: LINT_NAME.
///
/// &lt;The configuration field doc comment&gt;
(configuration_ident: Type = DefaultValue),</code></pre>
<p>The doc comment is automatically added to the documentation of the listed
lints. The default value will be formatted using the <code>Debug</code> implementation
of the type.</p>
</li>
<li>
<p>Adding the configuration value to the lint impl struct:</p>
<ol>
<li>
<p>This first requires the definition of a lint impl struct. Lint impl
structs are usually generated with the <code>declare_lint_pass!</code> macro. This
struct needs to be defined manually to add some kind of metadata to it:</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Generated struct definition
declare_lint_pass!(StructName =&gt; [
    LINT_NAME
]);

// New manual definition struct
pub struct StructName {}

impl_lint_pass!(StructName =&gt; [
    LINT_NAME
]);
<span class="boring">}</span></code></pre>
</li>
<li>
<p>Next add the configuration value and a corresponding creation method like
this:</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct StructName {
    configuration_ident: Type,
}

// ...

impl StructName {
    pub fn new(conf: &amp;'static Conf) -&gt; Self {
        Self {
            configuration_ident: conf.configuration_ident,
        }
    }
}
<span class="boring">}</span></code></pre>
</li>
</ol>
</li>
<li>
<p>Passing the configuration value to the lint impl struct:</p>
<p>First find the struct construction in the <a href="https://github.com/rust-lang/rust-clippy/blob/master/clippy_lints/src/lib.rs"><code>clippy_lints</code> lib file</a>. The
configuration value is now cloned or copied into a local value that is then
passed to the impl struct like this:</p>
<pre><code class="language-rust ignore">// Default generated registration:
store.register_*_pass(|| box module::StructName);

// New registration with configuration value
store.register_*_pass(move || box module::StructName::new(conf));</code></pre>
<p>Congratulations the work is almost done. The configuration value can now be
accessed in the linting code via <code>self.configuration_ident</code>.</p>
</li>
<li>
<p>Adding tests:</p>
<ol>
<li>The default configured value can be tested like any normal lint in
<a href="https://github.com/rust-lang/rust-clippy/blob/master/tests/ui"><code>tests/ui</code></a>.</li>
<li>The configuration itself will be tested separately in <a href="https://github.com/rust-lang/rust-clippy/blob/master/tests/ui-toml"><code>tests/ui-toml</code></a>.
Simply add a new subfolder with a fitting name. This folder contains a
<code>clippy.toml</code> file with the configuration value and a rust file that
should be linted by Clippy. The test can otherwise be written as usual.</li>
</ol>
</li>
<li>
<p>Update <a href="../lint_configuration.html">Lint Configuration</a></p>
<p>Run <code>cargo bless --test config-metadata</code> to generate documentation changes for the book.</p>
</li>
</ol>
<h2 id="cheat-sheet"><a class="header" href="#cheat-sheet">Cheat Sheet</a></h2>
<p>Here are some pointers to things you are likely going to need for every lint:</p>
<ul>
<li><a href="https://doc.rust-lang.org/nightly/nightly-rustc/clippy_utils/index.html">Clippy utils</a> - Various helper functions. Maybe the function you need
is already in here (<a href="https://doc.rust-lang.org/nightly/nightly-rustc/clippy_utils/ty/fn.implements_trait.html"><code>implements_trait</code></a>, <a href="https://doc.rust-lang.org/nightly/nightly-rustc/clippy_utils/source/fn.snippet.html"><code>snippet</code></a>, etc)</li>
<li><a href="https://github.com/rust-lang/rust-clippy/blob/master/clippy_utils/src/diagnostics.rs">Clippy diagnostics</a></li>
<li><a href="https://github.com/rust-lang/rust/pull/94927">Let chains</a></li>
<li><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_span/struct.Span.html#method.from_expansion"><code>from_expansion</code></a> and
<a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_span/struct.Span.html#method.in_external_macro"><code>in_external_macro</code></a></li>
<li><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_span/struct.Span.html"><code>Span</code></a></li>
<li><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_errors/enum.Applicability.html"><code>Applicability</code></a></li>
<li><a href="common_tools_writing_lints.html">Common tools for writing lints</a> helps with
common operations</li>
<li><a href="https://rustc-dev-guide.rust-lang.org/">The rustc-dev-guide</a> explains a lot of internal compiler
concepts</li>
<li><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/">The nightly rustc docs</a> which has been linked to throughout
this guide</li>
</ul>
<p>For <code>EarlyLintPass</code> lints:</p>
<ul>
<li><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_lint/trait.EarlyLintPass.html"><code>EarlyLintPass</code></a></li>
<li><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_ast/ast/index.html"><code>rustc_ast::ast</code></a></li>
</ul>
<p>For <code>LateLintPass</code> lints:</p>
<ul>
<li><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_lint/trait.LateLintPass.html"><code>LateLintPass</code></a></li>
<li><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/sty/index.html"><code>Ty::TyKind</code></a></li>
</ul>
<p>While most of Clippy’s lint utils are documented, most of rustc’s internals lack
documentation currently. This is unfortunate, but in most cases you can probably
get away with copying things from existing similar lints. If you are stuck,
don’t hesitate to ask on <a href="https://rust-lang.zulipchat.com/#narrow/stream/clippy">Zulip</a> or in the issue/PR.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../development/basics.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../development/defining_lints.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../development/basics.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../development/defining_lints.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>


        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace-2a3cd908.js"></script>
        <script src="../mode-rust-2c9d5c9a.js"></script>
        <script src="../editor-16ca416c.js"></script>
        <script src="../theme-dawn-4493f9c8.js"></script>
        <script src="../theme-tomorrow_night-9dbe62a9.js"></script>

        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
